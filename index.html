<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference - Wio Link</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="preface">Preface</h1>

<h2 id="about-tokens">About tokens</h2>

<p>There&rsquo;re two kinds of tokens: user token and node token. </p>

<p>And there will be a specification under each category of APIs. Please access the API endpoint with the right token, or you will get a 403 HTTP status code and a error message.</p>

<p>The user token can be obtained with /v1/user/create, /v1/user/changepassword, /v1/user/login API endpoints.</p>

<p>The node token can be obtained with /v1/nodes/create, /v1/nodes/list API endpoints, it&rsquo;s the value of &ldquo;node_key&rdquo; in the response.</p>

<h2 id="authorization">Authorization</h2>

<ul>
<li>with query string: xxxx/xxxx?access_token=[your token here]</li>
<li>with &ldquo;Authorization&rdquo; header: Authorization: token [your token here]</li>
</ul>

<h2 id="status-code-and-format-of-the-response">Status code and format of the response</h2>

<blockquote>
<p>GET request succeed:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="nt">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>POST request succeed:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"result"</span><span class="p">:</span><span class="s2">"ok"</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>All other error responses:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error message here"</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Status Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>OK - API call successfully executed.</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request - Wrong Grove/method name provided, or wrong parameter for method provided</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden - Your access token is not authorized.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found - The device you requested is not currently online, or the resource/endpoint you requested does not exist.</td>
</tr>
<tr>
<td>408</td>
<td>Timed Out - The server can not communicate with device in a specified time out period.</td>
</tr>
<tr>
<td>500</td>
<td>Server errors - It&rsquo;s usually caused by the unexpected errors of our side.</td>
</tr>
</tbody></table>

<p>If the debug mode is enabled, the error message will also include a field &ldquo;traceback&rdquo; whose value is the traceback of the error.</p>

<h1 id="user-management-apis">User management APIs</h1>

<h2 id="create-a-user-account">Create a user account</h2>
<pre class="highlight shell"><code>curl -d <span class="nv">email</span><span class="o">=[</span>email here] -d <span class="nv">password</span><span class="o">=[</span>password here] https://iot.seeed.cc/v1/user/create
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JLvvpkpmyMWQCOqUqPd5e4wR2f7wxM7fDmenWuxrcLs"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST /v1/user/create</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>string</td>
<td>The email address</td>
</tr>
<tr>
<td>password</td>
<td>string</td>
<td>The password</td>
</tr>
</tbody></table>

<aside class="notice">
Note: All the illustrated responses are the succeeded one, the error response is always {“error”: “error message here”} and the HTTP status code.
</aside>

<h2 id="change-the-password">Change the password</h2>
<pre class="highlight shell"><code>curl -d <span class="nv">password</span><span class="o">=[</span>new password here] https://iot.seeed.cc/v1/user/changepassword?access_token<span class="o">=</span>9L0_ofzPHnan91UQbtcCS4KzCI8BGQk6-OgMOtmnI3Q
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST /v1/user/changepassword</code></p>

<aside class="notice">
Require: User token
</aside>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>password</td>
<td>string</td>
<td>The new password</td>
</tr>
</tbody></table>

<h2 id="retreive-the-password">Retreive the password</h2>
<pre class="highlight shell"><code>curl -d <span class="nv">email</span><span class="o">=[</span>new email here] https://iot.seeed.cc/v1/user/retrievepassword
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If you forget your password, you can retrieve it by this API. You should specify the right email address, otherwise you will not receive the email with new password attached.</p>

<p><code class="prettyprint">POST /v1/user/retrievepassword</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>string</td>
<td>The email address of which account you want to retrieve password for</td>
</tr>
</tbody></table>

<h2 id="user-login">User login</h2>
<pre class="highlight shell"><code>curl -d <span class="nv">email</span><span class="o">=[</span>email here] -d <span class="nv">password</span><span class="o">=[</span>password here] https://iot.seeed.cc/v1/user/login
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JLvvpkpmyMWQCOqUqPd5e4wR2f7wxM7fDmenWuxrcLs"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST /v1/user/login</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>string</td>
<td>The email address</td>
</tr>
<tr>
<td>password</td>
<td>string</td>
<td>The password</td>
</tr>
</tbody></table>

<h1 id="nodes-management-apis">Nodes management APIs</h1>

<aside class="notice">
All require: User token
</aside>

<h2 id="create-a-node">Create a node</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span> -d <span class="nv">name</span><span class="o">=</span>node_1  https://iot.seeed.cc/v1/nodes/create
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"node_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e3d3b0fe920ddc3c69393fdbf83a2114"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"node_sn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"819554bd9519c94a19cc7fbd32447118"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST /v1/nodes/create</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>The name for the new node</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Fields of response</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>node_key</td>
<td>string</td>
<td>The node token</td>
</tr>
<tr>
<td>node_sn</td>
<td>string</td>
<td>The series number of this node</td>
</tr>
</tbody></table>

<h2 id="list-all-nodes-of-a-user">List all nodes of a user</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span> https://iot.seeed.cc/v1/nodes/list
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"nodes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"node_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e3d3b0fe920ddc3c69393fdbf83a2114"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"dataxserver"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"online"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weird name"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"node_sn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"819554bd9519c94a19cc7fbd32447118"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"node_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e3da3a2114asdfo9713801adfkjdhfa"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"dataxserver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.31.2"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"online"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nice name"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"node_sn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1242309jdfjk98087qejljdflkajdsf98"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>List all the nodes belong to a specific user, corresponding with the user token provided.</p>

<p><code class="prettyprint">GET /v1/nodes/list</code></p>

<table><thead>
<tr>
<th>Fields of response</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>The name of this node</td>
</tr>
<tr>
<td>node_key</td>
<td>string</td>
<td>The node token</td>
</tr>
<tr>
<td>node_sn</td>
<td>string</td>
<td>The series number of this node</td>
</tr>
<tr>
<td>dataxserver</td>
<td>string</td>
<td>The &ldquo;dataxserver&rdquo; is the data exchange server which is one of the two channels Wio Link talks with server(s). See https://github.com/Seeed-Studio/Wio_Link/wiki/Server%20Deployment%20Guide#3-deploy-a-local-lean-data-exchange-server for more detail. The default data exchange server is the same as OTA server when the node is created, and will be displayed &ldquo;null&rdquo; here. If set by API /v1/node/setting/dataxserver, the set address will be stored in database and will be displayed here.</td>
</tr>
<tr>
<td>online</td>
<td>string</td>
<td>The &ldquo;online&rdquo; fields stands for the connection status of the data channel. When one node has connected to a data exchange server, it will also sync the status with OTA server, then the OTA server will dispatch the status through this API.</td>
</tr>
</tbody></table>

<h2 id="rename-a-node">Rename a node</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span> https://iot.seeed.cc/v1/nodes/rename -d <span class="nv">node_sn</span><span class="o">=</span>160769ffa50feae76ec6f7a4fb95bf6c -d <span class="nv">name</span><span class="o">=</span>new_name
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST /v1/nodes/rename</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>node_sn</td>
<td>string</td>
<td>The SN of this node, get the SN with nodes/list API</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>The new name for this node</td>
</tr>
</tbody></table>

<h2 id="delete-a-node">Delete a node</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token StiLU1g5SNfQYWQLKpB7uMuE4l2uQuamKMBsIW1RGgA"</span> https://iot.seeed.cc/v1/nodes/delete -d <span class="s2">"node_sn=bac0df2d1b01b32c8ad3a0efbfc31c5f"</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST /v1/nodes/delete</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>node_sn</td>
<td>string</td>
<td>The SN of this node, get the SN with nodes/list API</td>
</tr>
</tbody></table>

<h1 id="grove-driver-apis">Grove driver APIs</h1>

<aside class="notice">
All require: User token
</aside>

<h2 id="get-all-grove-drivers-39-information">Get all grove drivers&rsquo; information</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span>  https://iot.seeed.cc/v1/scan/drivers
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"drivers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"SKU"</span><span class="p">:</span><span class="w"> </span><span class="s2">"104030003"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"grove_4_digit.cpp"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"grove_4_digit.h"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"ClassFile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grove_4_digit.h"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"GroveName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Grove - 4-Digit Display"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ImageURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.seeedstudio.com/depot/bmz_cache/3/3a9f79323a82950c12fc7e69fa9fab4d.image.530x397.jpg"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Writes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"write_display_point"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"Arguments"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="w">
              </span><span class="s2">"uint8_t"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"display"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"write_brightness"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"Arguments"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="w">
              </span><span class="s2">"uint8_t"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"brightness"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"HasPowerOffFunc"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ClassName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Grove4Digit"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Reads"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nt">"CanGetLastError"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Events"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nt">"HasEvent"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"InterfaceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UART"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"IncludePath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./grove_drivers/grove_4_digit"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"HasPowerOnFunc"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ConstructArgList"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"int pintx"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"int pinrx"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Get the driver database which is generated by the scanning process.</p>

<p><code class="prettyprint">GET /v1/scan/drivers</code></p>

<h2 id="get-the-status-of-last-driver-scanning">Get the status of last driver scanning</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span>  https://iot.seeed.cc/v1/scan/status
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scanned 40 grove drivers at 2015-12-25 15:22:10.796713"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error message here"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Failed"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The scanning process can be scheduled to be done periodically. Or triggered by the new driver commit at github.</p>

<p><code class="prettyprint">GET /v1/scan/status</code></p>

<h1 id="boards-platform-apis">Boards/Platform APIs</h1>

<aside class="notice">
All require: User token
</aside>

<h2 id="list-all-supported-boards">List all supported boards</h2>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token aKleqQebIsjmQMSCokemtgNXMD4Y7OTe3uyzEL1iwwA"</span> https://iot.seeed.cc/v1/boards/list
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"boards"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"board_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wio Link v1.0"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"board_vendor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"seeedstudio"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"board_flash_map"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
            </span><span class="nt">"board_flash_spi_speed"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w">
            </span><span class="nt">"board_flash_spi_mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"QIO"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"board_builtin"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"FUNCTION_KEY"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nt">"STATUS_LED"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"GROVE_POWER_SWITCH"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"interfaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"UART0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"pintx"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"pinrx"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UART"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"D2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GPIO"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"pin"</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"A0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANALOG"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"pin"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"I2C0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"pinscl"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I2C"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"pinsda"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"D0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GPIO"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"pin"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"D1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GPIO"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"pin"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Currently, only Wio Link board is supported. Welcome the community to add in more boards.</p>

<p><code class="prettyprint">GET /v1/boards/list</code></p>

<h1 id="single-node-apis">Single node APIs</h1>

<aside class="notice">
All require: Node token
</aside>

<h2 id="print-the-well-known-of-a-node">Print the well-known of a node</h2>

<blockquote>
<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/.well-known
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"well_known"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"GET /v1/node/GroveAccMMA7660/accelerometer -&gt; float ax, float ay, float az"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"GET /v1/node/Grove_Example1/with_arg/{int arg} -&gt; float cx, float cy, float cz, int degree"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"POST /v1/node/Grove_Example1/float_value &lt;- float f"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"HasEvent Grove_Button1 button_pressed"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"POST /v1/node/Grove_Gyro_ITG3200/zerocalibrate &lt;- void"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET /v1/node/.well-known</code></p>

<p>&ldquo;.well-known&rdquo; API prints all the available resources on that node. This API needs the node online.</p>

<p>The items on the right of the right arrow &ldquo;-&gt;&rdquo; are the properties that you can read via that API call, while the items on the right of the left arrow &ldquo;&lt;-&rdquo; are the values that you can write to that method/action.</p>

<p>&ldquo;HasEvent&rdquo; keyword indicates that there&rsquo;s a particular event which will be reported by that grove module, you can receive an explicit semantic event message from the event reporting websocket, e.g. {u&#39;msg&rsquo;: {u&#39;button_pressed&rsquo;: u&#39;0&rsquo;}} which means the button attached to GPIO0 is pressed.</p>

<h2 id="read-the-property-of-a-grove-module">Read the property of a Grove module</h2>

<blockquote>
<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/Grove_Example1/temp
</code></pre>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/Grove_Example1/with_argument/90
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"temp"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"cz"</span><span class="p">:</span><span class="w"> </span><span class="mf">78.0</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"cy"</span><span class="p">:</span><span class="w"> </span><span class="mf">45.6</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"cx"</span><span class="p">:</span><span class="w"> </span><span class="mf">12.3</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"degree"</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Read a specified property of a specified grove instance on that node, returns the json expression of the property.</p>

<p>Note: Get to know the type of arguments with .well-known API output</p>

<p><code class="prettyprint">GET /v1/node/GroveInstanceName/Property/{arg1}[/{arg2}][/{arg3}][/{arg4}]</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>GroveInstanceName</td>
<td>string</td>
<td>The instance name of the connected grove module, this is generated.</td>
</tr>
<tr>
<td>Property name</td>
<td>string</td>
<td>The readable property name of this module, get to know by the output of well-known API.</td>
</tr>
<tr>
<td>arg1, arg2, arg3, arg4</td>
<td>string, number</td>
<td>The arguments for the read function of the driver, the count of the arguments is not fixed, depending on the signature of the function.</td>
</tr>
</tbody></table>

<aside class="warning">
The parameters are location sensitive. They must follow the order of what the well-known output shows.
</aside>

<h2 id="write-to-a-grove-module">Write to a Grove module</h2>

<blockquote>
<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/Grove_Example1/float_value/10.5
</code></pre>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/Grove_Example1/multi_value/10/10.5/445566
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Write or set the value to a specified property/method/action of a specified grove instance on that node. By writting, you can pass data down to the grove hardware ,or trigger an action, or do some configuration onto the hardware.</p>

<p>Note: Get to know the type of arguments with .well-known API output</p>

<p><code class="prettyprint">POST /v1/node/GroveInstanceName/Property-or-Method-or-Action/{arg1}[/{arg2}][/{arg3}][/{arg4}]</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>GroveInstanceName</td>
<td>string</td>
<td>The instance name of the connected grove module, this is generated.</td>
</tr>
<tr>
<td>Property-or-Method-or-Action</td>
<td>string</td>
<td>The writable property name / action / method of this module, get to know by the output of well-known API.</td>
</tr>
<tr>
<td>arg1, arg2, arg3, arg4</td>
<td>string, number</td>
<td>The arguments for the write function of the driver, the count of the arguments is not fixed, depending on the signature of the function.</td>
</tr>
</tbody></table>

<aside class="warning">
The parameters are location sensitive. They must follow the order of what the well-known output shows.
</aside>

<h2 id="put-the-node-into-sleep-mode">Put the node into sleep mode</h2>

<blockquote>
<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST https://iot.seeed.cc/v1/node/pm/sleep/5?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Put the node into deep sleep mode in which the whole board&rsquo;s power will be shut down except that power of CP2102 if the system is powered by USB.</p>

<p>This will reduce the current consumption of the board to ~10mA if it&rsquo;s powered by micro USB (due to the usb to serial chip CP2102). And the current will drop to ~1mA if the board is powered by battery.</p>

<p>The sleep will not be intermittently triggered. You need to call the sleep API every time you want the node to sleep. You can continue to send GET/POST requests after a sleep command has been executed, the node will return a 404 status code and a message saying it&rsquo;s offline. Then the node wake up and join the router within about 5 seconds. You do some stuff and put the node into sleep again.</p>

<p><code class="prettyprint">POST /v1/node/pm/sleep/{sleep_time_sec}</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>sleep_time_sec</td>
<td>number</td>
<td>How many seconds you want the node to sleep</td>
</tr>
</tbody></table>

<h2 id="get-the-api-reference-page">Get the API reference page</h2>

<blockquote>
<p>Access through OTA Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/resources
</code></pre>

<p>An API reference web page will be rendered. With this reference page, you can lookup the URL of the APIs exposed and the events that node can produce.</p>

<p><code class="prettyprint">GET /v1/node/resources</code></p>

<h2 id="trigger-the-ota-process-for-node">Trigger the OTA process for node</h2>

<blockquote>
<p>Access through OTA Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> -H <span class="s2">"Content-Type: application/json"</span>  https://iot.seeed.cc/v1/ota/trigger -d <span class="s1">'{"board_name": "Wio Link v1.0", "connections":[{"port":"UART0", "sku":"111020001"},{"port":"I2C0", "sku":"101020050"}]}'</span>
</code></pre>

<blockquote>
<p>Configuration example</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"board_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wio Link v1.0"</span><span class="p">,</span><span class="w">    
    </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">    
        </span><span class="p">{</span><span class="w">        
            </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UART0"</span><span class="p">,</span><span class="w">            
            </span><span class="nt">"sku"</span><span class="p">:</span><span class="w"> </span><span class="s2">"111020001"</span><span class="w">            
        </span><span class="p">},</span><span class="w">        
        </span><span class="p">{</span><span class="w">        
            </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I2C0"</span><span class="p">,</span><span class="w">            
            </span><span class="nt">"sku"</span><span class="p">:</span><span class="w"> </span><span class="s2">"101020050"</span><span class="w">            
        </span><span class="p">}</span><span class="w">        
    </span><span class="p">]</span><span class="w">    
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Response if the OTA is triggered successfully:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"ota_msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Building the firmware.."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ota_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"going"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This API let user trigger the OTA process, with a configuration description in json format. The request should be sent in &lsquo;application/json&rsquo; content-type and the request body is a json object describes the connection of grove modules on the node.</p>

<p>If the OTA has been executed, a response with &ldquo;ota_status&rdquo; field will be returned. This is the first status of the OTA process - &ldquo;Building the firmware&rdquo;. Then you can poll the &ldquo;/v1/ota/status&rdquo; API to track the OTA states.</p>

<p><code class="prettyprint">POST /v1/ota/trigger</code></p>

<p>The OTA process can also be split into two phases: </p>

<ul>
<li>Phase1 - Generate source files</li>
<li>Phase2 - Build the firmware and transfer over the air to the node</li>
</ul>

<p>To specify the phase, you can pass a parameter <em>build_phase</em> in the URL.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>build_phase</td>
<td>number</td>
<td>1 - Only do phase 1<br>2 - Only do phase 2<br>3 or without this parameter - Do two phases</td>
</tr>
</tbody></table>

<blockquote>
<p>Only phase 1</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span>  https://iot.seeed.cc/v1/ota/trigger?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2&amp;build_phase<span class="o">=</span>1 -d <span class="s1">'{"board_name": "Wio Link v1.0", "connections":[{"port":"UART0", "sku":"111020001"},{"port":"I2C0", "sku":"101020050"}]}'</span>
</code></pre>

<blockquote>
<p>Only phase 2 (Must pass phase 1 before)</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST https://iot.seeed.cc/v1/ota/trigger?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2&amp;build_phase<span class="o">=</span>2 
</code></pre>

<h2 id="track-the-ota-status">Track the OTA status</h2>

<blockquote>
<p>Access through OTA Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/ota/status
</code></pre>

<blockquote>
<p>Different states will be returned continuously</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"ota_msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Downloading the firmware.."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ota_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"going"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"ota_msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Failed to send the binary"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ota_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"ota_msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Firmware updated"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ota_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"done"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>User can send long-poll GET request to retrieve the OTA states. The request will be timeout after 3 minutes if there&rsquo;s no states reported. Or a json response carrying the OTA state will be returned. The &ldquo;ota_status&rdquo; will have 3 values: going, done, error.</p>

<p>going - the OTA is still going on, will report more going state.</p>

<p>done - the OTA has succeeded, the firmware of node has been updated.</p>

<p>error - error happened during the OTA process.</p>

<p><code class="prettyprint">GET /v1/ota/status</code></p>

<h2 id="get-the-configuration-of-node">Get the configuration of node</h2>

<blockquote>
<p>Access through OTA Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token d6d68b4b6b43f213569f5832dd8277b2"</span> https://iot.seeed.cc/v1/node/config
</code></pre>

<p>Response if the OTA is triggered successfully:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"board_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wio Link v1.0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">    
            </span><span class="p">{</span><span class="w">        
                </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UART0"</span><span class="p">,</span><span class="w">            
                </span><span class="nt">"sku"</span><span class="p">:</span><span class="w"> </span><span class="s2">"111020001"</span><span class="w">            
            </span><span class="p">},</span><span class="w">        
            </span><span class="p">{</span><span class="w">        
                </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I2C0"</span><span class="p">,</span><span class="w">            
                </span><span class="nt">"sku"</span><span class="p">:</span><span class="w"> </span><span class="s2">"101020050"</span><span class="w">            
            </span><span class="p">}</span><span class="w">        
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This API let user retrieve the configuration file uploaded in last OTA process.</p>

<p><code class="prettyprint">GET /v1/node/config</code></p>

<h2 id="change-the-data-exchange-server-for-node">Change the data exchange server for node</h2>

<blockquote>
<p>Access through OTA Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST https://iot.seeed.cc/v1/node/setting/dataxserver/192.168.31.2?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Change the data exchange server for a specific node. As the changing will be taken place at the node side, this API needs the node online. This API will cause the node reboot once. After rebooted, the node will interact with the configured data exchange server for data and event transmission. And the configured data exchange server can be queried with the nodes/list API.</p>

<p><code class="prettyprint">POST /v1/node/setting/dataxserver/{address}</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>address</td>
<td>string</td>
<td>The IP address of the data x server. Only IP address supported.</td>
</tr>
</tbody></table>

<h1 id="node-event-api-use-websocket">Node Event API (use Websocket)</h1>

<h2 id="connect-wss-iot-seeed-cc-v1-node-event">connect wss://iot.seeed.cc/v1/node/event</h2>

<blockquote>
<p>Example code:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s1">'wss://iot.seeed.cc/v1/node/event'</span><span class="p">);</span>
<span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"d6d68b4b6b43f213569f5832dd8277b2"</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>

<blockquote>
<p>The event data format like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"event_name_here"</span><span class="p">:</span><span class="w"> </span><span class="s2">"event_data_here"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If you want to get the event from node at more real time, you can connect to the event reporting endpoint with WebSocket. After, send the Node Key to complete the handshake. Then, the <code class="prettyprint">onmessage</code> will get event data when node post it.</p>

<h1 id="coding-on-the-fly">Coding on the fly</h1>

<h2 id="user-39-s-logic-block">User&rsquo;s logic block</h2>

<p>User&rsquo;s logic block (ULB) is a piece of c++ code which will be compiled into the firmware and run natively on Wio Link. One can modify the ULB between build phase 1 and build phase 2. The ULB has an Arduino style sketch which consists of setup and loop functions. The ULB will be uploaded onto the server and put into a build directory related to a particular node.</p>

<aside class="notice">
All require: Node token
</aside>

<blockquote>
<p>Access through OTA Server</p>

<p>Upload ULB:</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span>  https://iot.seeed.cc/v1/cotf/project?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2 -d <span class="s1">'{
  "./Main.h": "source code here",
  "./Main.cpp": "source code here",
  "./other_file.cpp": "source code here",
  "./dir1/file1.h": "source code here"
}'</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Download ULB:</p>
</blockquote>
<pre class="highlight shell"><code>curl https://iot.seeed.cc/v1/cotf/project?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"./Main.h"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source code here"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"./Main.cpp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source code here"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"./other_file.cpp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source code here"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"./dir1/file1.h"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source code here"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="program-ulb">Program ULB</h2>
<pre class="highlight cpp"><code><span class="kt">uint32_t</span> <span class="n">time</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
        <span class="c1">//do things here...
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In the ULB, you can call the functions of all the grove modules selected in build phase 1. The grove modules selected in build phase 1 will expose read/write API endpoints and events congenitally. The event will be duplicated and be buffered in two event queue: the external event queue and the internal event queue. The events in external event queue will be dispatched to the event API (websocket). The events in internal event queue can be fetched by the ULB. Both queue has a depth of 100.</p>

<p>In the ULB, you can also interact with outside with the following functionalities:</p>

<ul>
<li>Register a variable, read and write the value of it through API</li>
<li>Register a function, call it through API</li>
<li>Post events</li>
</ul>

<p>You should use delay very carefully because the watch dog will reset the Wio Link if delay more over 10ms. And the worst thing is that the Wio Link can never be OTAed if you programmed a bad ULB which causes the Wio Link reboot again and again. Once your Wio Link run into this situation, you can fix it with the guide of <a href="https://github.com/Seeed-Studio/Wio_Link/wiki/Advanced%20User%20Guide#5-repair-bricked-wio-link">this document</a>. We highly recommend use the time-point-check model to handle time.</p>

<h2 id="variable">Variable</h2>

<blockquote>
<p>Register a variable</p>
</blockquote>
<pre class="highlight c"><code><span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">123</span><span class="p">.</span><span class="mi">45</span><span class="p">;</span>
<span class="n">String</span> <span class="n">s</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">wio</span><span class="p">.</span><span class="n">registerVar</span><span class="p">(</span><span class="s">"var1"</span><span class="p">,</span> <span class="n">var1</span><span class="p">);</span>
<span class="n">wio</span><span class="p">.</span><span class="n">registerVar</span><span class="p">(</span><span class="s">"var2"</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
<span class="n">wio</span><span class="p">.</span><span class="n">registerVar</span><span class="p">(</span><span class="s">"var3"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</code></pre>

<blockquote>
<p>Read a variable</p>

<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl https://iot.seeed.cc/v1/node/variable/var1?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2
</code></pre>

<p>Data type supported:</p>

<p>bool, uint8_t, int8_t, uint16_t, int16_t, uint32_t, int32_t, float, const char *, String.</p>

<p>All data types support reading.</p>

<p>All data types support writing except for const char *  and String.</p>

<p><code class="prettyprint">GET /v1/node/variable/{variable name}</code></p>

<blockquote>
<p>Write a variable</p>

<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST https://iot.seeed.cc/v1/node/variable/var1/200?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2
</code></pre>

<p><code class="prettyprint">POST /v1/node/variable/{variable name}/{variable value}</code></p>

<h2 id="function">Function</h2>

<blockquote>
<p>Register a function</p>
</blockquote>
<pre class="highlight c"><code><span class="kt">void</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">String</span> <span class="n">para</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Serial1</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">para</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="n">wio</span><span class="p">.</span><span class="n">registerFunc</span><span class="p">(</span><span class="s">"func1"</span><span class="p">,</span> <span class="n">myfunc</span><span class="p">);</span>
<span class="p">...</span>
</code></pre>

<blockquote>
<p>Call a function</p>

<p>Access through Data Exchange Server</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST https://iot.seeed.cc/v1/node/function/func1?access_token<span class="o">=</span>d6d68b4b6b43f213569f5832dd8277b2 -d <span class="nv">arg</span><span class="o">=</span><span class="s2">"argument here"</span>
</code></pre>

<p>Only support one String type parameter.</p>

<p><code class="prettyprint">POST /v1/node/function/{function name}</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>arg</td>
<td>string</td>
<td>The argument for the registered function, POST should be sent in x-www-form-urlencoded format.</td>
</tr>
</tbody></table>

<h2 id="read-events-from-connected-grove-modules">Read events from connected grove modules</h2>
<pre class="highlight c"><code><span class="n">event_t</span> <span class="n">event</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">wio</span><span class="p">.</span><span class="n">eventAvailable</span><span class="p">())</span>
<span class="p">{</span>
        <span class="n">wio</span><span class="p">.</span><span class="n">getEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">event_name</span><span class="p">,</span> <span class="s">"encoder_position"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int32_t</span> <span class="n">event_data</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">event_data</span><span class="p">.</span><span class="n">s32</span><span class="p">;</span>
            <span class="n">Serial1</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">event_data</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">event_name</span><span class="p">,</span> <span class="s">"ir_recv_data_hex"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">char</span> <span class="o">*</span><span class="n">event_data</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">event_data</span><span class="p">.</span><span class="n">p_str</span><span class="p">;</span>
            <span class="n">Serial1</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">event_data</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre>

<blockquote>
<p>To get the event data, you should read the correct item of the union:</p>
</blockquote>
<pre class="highlight c"><code><span class="k">union</span>
<span class="p">{</span>
    <span class="kt">uint8_t</span>         <span class="n">raw</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="kt">uint8_t</span>         <span class="n">u8</span><span class="p">;</span>
    <span class="kt">uint16_t</span>        <span class="n">u16</span><span class="p">;</span>
    <span class="kt">uint32_t</span>        <span class="n">u32</span><span class="p">;</span>
    <span class="n">bool</span>            <span class="n">boolean</span><span class="p">;</span>
    <span class="kt">int8_t</span>          <span class="n">s8</span><span class="p">;</span>
    <span class="kt">int16_t</span>         <span class="n">s16</span><span class="p">;</span>
    <span class="kt">int32_t</span>         <span class="n">s32</span><span class="p">;</span>
    <span class="kt">int</span>             <span class="n">integer</span><span class="p">;</span>
    <span class="kt">float</span>           <span class="n">f</span><span class="p">;</span>
    <span class="kt">char</span>            <span class="o">*</span><span class="n">p_str</span><span class="p">;</span>
    <span class="kt">void</span>            <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span><span class="n">event_data</span><span class="p">;</span>
</code></pre>

<h2 id="post-events">Post events</h2>
<pre class="highlight c"><code><span class="n">wio</span><span class="p">.</span><span class="n">postEvent</span><span class="p">(</span><span class="s">"my_event"</span><span class="p">,</span> <span class="n">event_data_var</span><span class="p">);</span>
</code></pre>

<p>Data types supported for event data:</p>

<p>bool, uint8_t, int8_t, uint16_t, int16_t, uint32_t, int32_t, float, const char *, String</p>

<p>wio.postEvent() will post an event into external event queue, and then can be fetched with the <em>Node Event API (use Websocket)</em>.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
